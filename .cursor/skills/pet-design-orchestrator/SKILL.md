---
name: pet-design-orchestrator
description: 编排完整宠物定制图像工作流，协调项目内技能按图像状态与用户指令执行，实现增量更新而非整图重生成。用户进行宠物产品图定制、初次生成或基于指令微调时使用。
---

**实现与脚本**：本技能逻辑与脚本未改动，位于项目 `skills/pet-design-orchestrator/` 与 `scripts/`；此处为 Cursor 约定入口，便于 Agent 发现。

# 宠物设计编排器（pet-design-orchestrator）

编排完整宠物定制图像工作流，协调现有项目技能，根据**图像数量**、**图像状态**与**用户指令**决定执行哪些步骤；始终做**增量更新**，避免不必要的重跑。**每次订单（原图 + 客户文字需求）对应一个会话**，单宠与多宠均输出到 `sessions/<session_id>/`。

## 核心路由

- **检测图片数量**：1 张 → 单宠物流程；2 张及以上 → 多宠物流程。用户指令含「两只/多只/合照」等时强制多宠物。
- **统一入口脚本**：单宠与多宠均使用 `run_multi_pet_with_circle_text`，输出到 `sessions/<session_id>/`。
- 路由决策逻辑、状态检查、用户指令优先级见 **skills/pet-design-orchestrator/reference.md**「路由机制」与「技能与编排器对应关系」。

## 工作流摘要

- **初次生成**：初始化会话 → 抠图（单宠 `pet_a` / 多宠 `pet_a, pet_b, ...`）→ 合成 `design.png` → 可选圆形文字 `design_final.png` → 写 `state.json`。
- **按指令更新**：仅执行与指令相关的技能（如仅位置、仅文字、仅圆形文字、重抠、画质优化），不重跑无关步骤。
- 单宠/多宠的详细步骤与可用技能表见 **skills/pet-design-orchestrator/reference.md**「技能与编排器对应关系」「默认工作流」；会话目录结构见「会话目录与文件约定」。

## 约束

- **不重跑已完成步骤**：除非用户明确要求（如「重新抠图」「从头再来」）。
- **不重跑清晰度增强或补齐**：除非用户明确要求重置或重抠。
- **保留已有结果**：在已有产品图上只做增量更新。
- **输出**：始终返回当前最新产品图路径（或 URL）。

## 何时读 reference

- 需要**路由决策细节、可用技能表、按指令类型与技能映射**时，读 **skills/pet-design-orchestrator/reference.md**「路由机制」「技能与编排器对应关系」「指令解析与行为」。
- 需要**会话目录结构、文件约定、编排器根据文件是否存在判断是否跳过**时，读「会话目录与文件约定」。
- 需要**错误与边界处理、路由实现示例**时，读「错误与边界情况」「路由决策实现示例」。
